#!/bin/bash
# Monitoring script for job 13633742 (test_val_loss_gpu)

JOB_ID=13633742
LOG_OUT="logs/test_val_loss_gpu_${JOB_ID}.out"
LOG_ERR="logs/test_val_loss_gpu_${JOB_ID}.err"

echo "========================================"
echo "üîç MONITORING TEST VAL LOSS GPU - JOB ${JOB_ID}"
echo "========================================"
echo ""

# Check job status
echo "üìä Job Status:"
squeue -j ${JOB_ID}
echo ""

# Check if job is running
JOB_STATE=$(squeue -j ${JOB_ID} -h -o "%T" 2>/dev/null)

if [ -z "$JOB_STATE" ]; then
    echo "‚úÖ Job completed or not in queue"
    echo ""

    if [ -f "$LOG_OUT" ]; then
        echo "========================================"
        echo "üìä FULL OUTPUT:"
        echo "========================================"
        cat "$LOG_OUT"
        echo ""
    else
        echo "‚ö†Ô∏è  Output log not found: $LOG_OUT"
    fi

    if [ -f "$LOG_ERR" ]; then
        echo "========================================"
        echo "‚ùå ERRORS (if any):"
        echo "========================================"
        cat "$LOG_ERR"
    fi

elif [ "$JOB_STATE" == "RUNNING" ]; then
    echo "‚úÖ Job is RUNNING"
    echo ""

    if [ -f "$LOG_OUT" ]; then
        echo "üìä Current output:"
        cat "$LOG_OUT"
    else
        echo "‚è≥ Log file not created yet..."
    fi

elif [ "$JOB_STATE" == "PENDING" ]; then
    echo "‚è≥ Job is PENDING (waiting for GPU)"

else
    echo "‚ÑπÔ∏è  Job state: $JOB_STATE"
fi

echo ""
echo "========================================"
echo "‚è∞ Checked at: $(date)"
echo "========================================"
