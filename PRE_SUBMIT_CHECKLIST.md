# Pre-Submit Checklist - TopoFlow Training

## âœ… Configuration Verified

### SLURM Script: `scripts/slurm_topoflow_elevation.sh`
- âœ… Project: 462001079
- âœ… Time: 24:00:00
- âœ… Nodes: 50 (400 GPUs total)
- âœ… Config path: configs/config_topoflow_elevation.yaml

### Config: `configs/config_topoflow_elevation.yaml`
- âœ… max_steps: 20000
- âœ… warmup_steps: 2000
- âœ… scheduler: cosine
- âœ… batch_size: 2
- âœ… num_nodes: 50 (matches SLURM)
- âœ… devices: 8 (matches SLURM)
- âœ… **NO checkpoint_path** â†’ Training from scratch âœ…
- âœ… use_physics_mask: true
- âœ… parallel_patch_embed: false (row-major, no wind reordering)

### Model Integration: `src/climax_core/arch.py`
- âœ… TopoFlowBlock imported
- âœ… First block replaced with TopoFlow
- âœ… Forward pass updated to use elevation_patches + u_wind + v_wind
- âœ… Test passed: model.climax.blocks[0] is TopoFlowBlock

### Test Results: `test_topoflow_simple.py`
```
âœ… TopoFlow enabled: block 0, grid 64Ã—128, elevation+wind
4. First block is TopoFlowBlock: True
   - elevation_alpha: 1.000
   - wind_beta: 0.300
   - H_scale: 1000.0
âœ… ALL GOOD - Model is ready!
```

## ðŸ“Š Training Parameters

| Parameter | Value |
|-----------|-------|
| GPUs | 400 (50 nodes Ã— 8) |
| Steps | 20,000 |
| Batch size | 2 per GPU |
| Effective batch | 800 (2 Ã— 400) |
| Accumulate grad | 2 |
| Learning rate | 0.0001 |
| Scheduler | Cosine |
| Precision | 32-bit |

## ðŸŽ¯ Expected Behavior

1. **Model initialization:**
   - First block: TopoFlowBlock with elevation attention
   - Blocks 1-5: Standard Transformer blocks

2. **Training:**
   - From scratch (no checkpoint)
   - Should converge faster than baseline due to physics inductive bias
   - Target: val_loss < 0.264 (beat row-major baseline)

3. **Logs:**
   - Output: `logs/topoflow_elevation_13473924.out`
   - Errors: `logs/topoflow_elevation_13473924.err`

## ðŸš€ Ready to Submit

All checks passed. Safe to submit!

**Command:**
```bash
cd /scratch/project_462000640/ammar/aq_net2
sbatch scripts/slurm_topoflow_elevation.sh
```
